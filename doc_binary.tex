%===============================================================================
%  LaTeX  DOCUMENTATION -- v2.1 (extended, ~6 pages @ 11 pt)
%  “Binary‑Star Modules”  (REBOUNDx ≥ 3.12, rev. B   10 Jul 2025)
%===============================================================================
\documentclass[11pt]{article}
\usepackage[a4paper,margin=2.3cm]{geometry}
\usepackage{amsmath,amssymb,amsfonts,bm}
\usepackage{graphicx}
\usepackage{booktabs}
\usepackage{enumitem}
\usepackage{listings}
\usepackage{hyperref}
\usepackage{natbib}
\hypersetup{colorlinks=true,linkcolor=blue,citecolor=blue,urlcolor=blue}

\lstset{basicstyle=\ttfamily\footnotesize,
        keywordstyle=\color{blue},
        commentstyle=\color{gray},
        columns=fullflexible,
        keepspaces=true,
        frame=single}

\begin{document}

\title{\textsc{Binary‑Star Evolution Modules in
         \textnormal{REBOUNDx}}:\\
       Roche‑Lobe Transfer, Magnetic Braking, Stellar Winds, Thermally Driven Winds, Simplified
       Stellar Evolution, and Relativity}
\author{Operator files: \texttt{roche\_lobe\_mass\_transfer.c},
        \texttt{magnetic\_braking.c},
        \texttt{stellar\_wind\_mass\_loss.c},
        \texttt{thermally\_driven\_winds.c},
        \texttt{stellar\_evolution\_sse.c},
        \texttt{post\_newtonian.c}\\
        Revision B – 10 July 2025}
\date{}
\maketitle
\vspace*{-1.5em}

%-------------------------------------------------------------------------------
\begin{abstract}
We document the binary‑star evolution modules distributed with
\textsc{REBOUNDx} $\ge$ 3.12 (revision B, 10 Jul 2025).
The Roche‑lobe mass transfer operator combines overflow, non‑conservative
systemic winds, and common‑envelope drag within a momentum‑conserving
framework featuring adaptive sub‑stepping and robust merge guards.
Separate operators implement magnetic braking, isotropic stellar‑wind
mass loss, thermally driven winds, simplified stellar‑evolution scalings,
and post‑Newtonian relativistic corrections up to 2.5PN order with spin--orbit and spin--spin couplings.  Equations are derived,
parameters are tabulated, and algorithmic
choices are clarified so that this document can serve as an archival,
citable reference.
\end{abstract}

%-------------------------------------------------------------------------------
\section{Background and Motivation}
\label{sec:intro}
Roche‑lobe overflow, common‑envelope evolution, stellar winds,
thermally driven winds, magnetic braking, simplified stellar evolution, and relativistic effects
govern the orbital fates of close binaries\citep{Eggleton1983,Ostriker1999,
Peters1964,Reimers1975,Verbunt1981,Kawaler1988,Hurley2000}.  Hydrodynamic
simulations capture these effects but are computationally prohibitive for
population synthesis, while purely secular codes lack the fidelity needed
for higher‑order dynamical systems (e.g.\ triples or cluster environments).
The modules documented here bridge these regimes by injecting carefully
book‑kept mass changes and dissipative forces into an otherwise
high‑precision $N$‑body integration.

The Roche‑lobe mass transfer operator:

\begin{itemize}[nosep,leftmargin=1.8em]
\item tracks \emph{all} linear momentum channels to machine precision;
\item offers four specific‑angular‑momentum prescriptions for systemic winds;
\item prevents numerical divergence near coalescence through tight merge guards;
\item adapts internal sub‑steps based on mass‑loss and dynamical
      time‑scale criteria; and
\item exposes an optional donor mass‑radius power law for adiabatic
      responses to mass loss.
\end{itemize}

%-------------------------------------------------------------------------------
\section{Physical Model and Mathematical Formulation}

\subsection{Roche‑Lobe Overflow (RLOF)}
\label{sec:RLOF}

\paragraph{Roche‑lobe radius.}
The Eggleton formula~\cite{Eggleton1983} for the donor’s
volume‑equivalent Roche radius,
\begin{equation}
R_{\mathrm L}
 = a\,
   \frac{0.49\,q^{2/3}}{0.60\,q^{2/3}+\ln(1+q^{1/3})},
\qquad
q\equiv\frac{M_{\mathrm d}}{M_{\mathrm a}},
\label{eq:Eggleton}
\end{equation}
is evaluated at run time to compute the overflow degree.

\paragraph{Mass‑loss law.}
The donor’s instantaneous mass‑loss rate follows
\citet{Ritter1988}:
\begin{equation}
\dot M_{\mathrm d}
 = -\dot M_0
   \exp\!\bigl[(R_{*}-R_{\mathrm L})/H_P\bigr],
\label{eq:Ritter}
\end{equation}
with the exponent clamped to $\le80$ to avoid floating‑point overflow
(\texttt{RLMT\_EXP\_CLAMP}).

\paragraph{Envelope veto.} If \texttt{rlmt\_skip\_in\_CE}=1\ (the default), the RLOF calculation is bypassed whenever the accretor resides inside the donor’s radius ($r<R_*$), allowing common‑envelope drag to dominate.

\paragraph{Non‑conservative transfer.}
A user‑set fraction $f_{\mathrm loss}\in[0,1]$ escapes as a wind,
\begin{equation}
\dot M_{\mathrm a}=-(1-f_{\mathrm loss})\,\dot M_{\mathrm d},\qquad
\dot M_{\mathrm wind}=f_{\mathrm loss}\,|\dot M_{\mathrm d}|.
\label{eq:noncon}
\end{equation}

\paragraph{Specific linear momentum of the wind.}
Four prescriptions can be selected at run time:
\begin{subequations}\label{eq:joptions}
\begin{align}
\mathbf v_{\mathrm{loss}} &= \mathbf v_{\mathrm d} && (\text{mode }0)\\
                            &= \mathbf v_{\mathrm a} && (\text{mode }1)\\
                            &= \frac{M_{\mathrm d}\,\mathbf v_{\mathrm d}+M_{\mathrm a}\,\mathbf v_{\mathrm a}}
                               {M_{\mathrm d}+M_{\mathrm a}} && (\text{mode }2)\\
                            &= \mathbf v_{\mathrm d} + f_j\,\mathbf e_\perp
                               \frac{j_{\rm orb}}{r} && (\text{mode }3),
\end{align}
\end{subequations}
where $\mathbf e_\perp$ is any unit vector orthogonal to the separation
vector, $j_{\rm orb}=|\mathbf r\times\mathbf v|\,\mu^{-1}$ with reduced mass
$\mu=M_{\mathrm d}M_{\mathrm a}/(M_{\mathrm d}+M_{\mathrm a})$, and
$r=|\mathbf r|$ is the instantaneous separation.

\paragraph{Momentum bookkeeping and angular‑momentum correction.}
Accreted material arrives with the donor’s velocity, while wind
particles remove the momentum $m_{\mathrm wind}\mathbf v_{\mathrm loss}$.
After each RLOF step a minimal
velocity shift
\(
\delta\mathbf v=(\Delta\mathbf L\times\mathbf r_{\mathrm a})/(M_{\mathrm a}r_{\mathrm a}^2)
\)
is applied to the accretor to compensate for the angular momentum carried by
the transferred gas and keep the system’s total angular momentum unchanged.
The donor receives the opposite kick scaled by $M_{\mathrm a}/M_{\mathrm d}$ so
that linear momentum remains conserved. For diagnostics the accumulated
energy change $\Delta E$ from mass transfer and the angular‑momentum
correction is written to the operator attribute \texttt{rlmt\_last\_dE}.

\paragraph{Donor radius evolution (optional).}
If the donor supplies a non-zero \texttt{rlmt\_R\_slope}, its radius is updated
after each sub-step according to the power law
\[
R_{\mathrm d}(M)=R_{\mathrm ref}
\left(\frac{M}{M_{\mathrm ref}}\right)^{\alpha_R},
\]
where $\alpha_R$ is \texttt{rlmt\_R\_slope}. The reference values
\texttt{rlmt\_R\_ref\_mass} and \texttt{rlmt\_R\_ref\_radius} default to the
donor's initial mass and radius if not provided. This enables adiabatic or
thermally driven mass–radius responses.

%-------------------------------------------------------------------------------
\subsection{Common–Envelope (CE) Dynamical Friction}
\label{sec:ce_drag}

\paragraph{Drag acceleration.}
When the accretor resides inside the donor ($r<R_*)$ and a density profile is
available, a companion of mass $M_{\mathrm a}$ moving through envelope gas
experiences
\[
\mathbf a_{\rm DF}=
-\frac{4\pi\,G^2\,M_{\mathrm a}\,\rho}{v_{\rm rel}^3}\,
   I(\mathcal M)\,\mathbf v_{\rm rel},
\qquad
\mathcal M\equiv\frac{v_{\rm rel}}{c_s},
\]
where the dimensionless factor is
\begin{equation}
I(\mathcal M)=
\begin{cases}
\dfrac{1}{3}\mathcal M^3+\dfrac{1}{5}\mathcal M^5,&\mathcal M<0.02,\\[0.6em]
\dfrac{1}{2}\ln\!\dfrac{1+\mathcal M}{1-\mathcal M}-\mathcal M,
 & 0.02\le\mathcal M<1,\\[0.6em]
\ln\!\bigl(1/x_{\min}\bigr),&\mathcal M\ge1.
\end{cases}
\label{eq:I_prefactor}
\end{equation}
For $\mathcal M<1$ the implementation additionally caps the result at
$\ln(1/x_{\min})$,
ensuring $I(\mathcal M)\le\ln(1/x_{\min})$ in \emph{all} regimes.

\paragraph{Hydrodynamic accretion term (optional).}
If \texttt{ce\_Qd}$>$0 and the accretor's radius $R_{\mathrm acc}$ (taken from its
\texttt{r} field) is positive, a Bondi–Hoyle–like contribution
\[
\mathbf a_{\rm GM}
=-\frac{\pi\,\rho\,R_{\mathrm acc}^2\,v_{\rm rel}\,Q_d}{M_{\mathrm a}}
\,\mathbf v_{\rm rel}
\]
is added.

\paragraph{Envelope structure.}
Density $\rho$ and sound speed $c_s$ are taken from either
(i) a power‑law $\rho=\rho_0s^{\alpha_\rho}$, $c_s=c_{s0}s^{\alpha_{c_s}}$
specified by the operator parameters \texttt{ce\_rho0}, \texttt{ce\_alpha\_rho},
\texttt{ce\_cs}, and \texttt{ce\_alpha\_cs}; or
(ii) a user‑supplied tabulated profile $(s,\rho,c_s)$ loaded once via
\texttt{ce\_profile\_file}.  The table overrides the power‑law and is sampled
with log–log linear interpolation.  If neither option is provided the CE drag
step is skipped.

\paragraph{CFL‑like limiter.}
The velocity kick magnitude is limited to
$|\Delta\mathbf v|\le\texttt{ce\_kick\_cfl}\times c_s$ to preserve accuracy
in highly supersonic or stratified flows.

\paragraph{Numerical stability.}
Before evaluating the drag, the relative speed is floored to
$v_{\rm rel,eff}=\max(v_{\rm rel},10^{-3}c_s)$ so the prefactor in
Eq.~\eqref{eq:I_prefactor} remains finite even for very small Mach numbers.
The sub‑step criteria $\Delta r/r\le\texttt{rlmt\_substep\_max\_dr}$ and
$\Delta M/M\le\texttt{rlmt\_substep\_max\_dm}$ provide additional control over
numerical stability.

%-------------------------------------------------------------------------------
\subsection{Magnetic Braking}
\label{sec:mb}

Low‑mass stars with convective envelopes lose spin angular momentum through
magnetised winds.  The implementation follows the Verbunt–Zwaan and Kawaler
torque law \citep{Verbunt1981,Kawaler1988}, applying a braking torque
antiparallel to the star's spin vector.

\paragraph{Torque law.} For a star of mass $M$, radius $R$, and angular
velocity $\omega = |\bm\Omega|$, the spin‑down torque is
\begin{equation}
\tau = -K R^{1/2} M^{-1/2} \omega^3,
\label{eq:mb_torque}
\end{equation}
where $K$ is a user‑set normalisation (parameter \texttt{mb\_K}, default
$2.7\times10^{47}$ in cgs).  The torque modifies the spin by
$\dot{\bm\Omega}=\tau\,\bm\Omega/(I\,\omega)$ with $I$ the particle's moment
of inertia.

\paragraph{Units and scaling.} The parameter \texttt{mb\_K} is specified in cgs
units but is internally converted to the simulation's unit system using the
operator parameters \texttt{mb\_Msun}, \texttt{mb\_Rsun}, and \texttt{mb\_year},
which define the solar mass, solar radius, and Julian year in code units.
Users therefore need not rescale $K$ manually.

\paragraph{Saturation.} If a particle specifies a saturation threshold
the critical angular velocity $\omega_{\rm sat}$ is determined as follows.
If the particle supplies a convective turnover time \texttt{mb\_tau\_conv}, the
code sets $\omega_{\rm sat}=2\pi/(\texttt{mb\_Rossby\_sat}\times\texttt{mb\_tau\_conv})$,
where the operator parameter \texttt{mb\_Rossby\_sat} (default 0.1) is the
critical Rossby number.  A user-specified \texttt{mb\_omega\_sat} overrides this
value.  When $\omega>\omega_{\rm sat}$, the cubic dependence in
Eq.~\eqref{eq:mb_torque} is replaced with $\omega\,\omega_{\rm sat}^2$, so the
torque scales linearly with $\omega$ above the threshold.

\paragraph{Activation.} Magnetic braking is applied only when a particle sets
\texttt{mb\_on}=1 and has \texttt{mb\_convective}=1. Missing parameters,
non‑positive $I$, vanishing spin vectors, or non‑finite $M$ or $R$ all
bypass the update.  The spin is rescaled by $1+[(\tau/I\omega)\,\Delta t]$;
if this factor would be non‑positive—and thus flip the spin—the step is
skipped.

\begin{table}[h]
\centering\footnotesize
\caption{Magnetic braking parameters}
\label{tab:mb}
\begin{tabular}{@{}llll@{}}
\toprule
Name (scope) & Unit & Default & Purpose \\
\midrule
\texttt{mb\_K} (op) & cgs & $2.7\times10^{47}$ & Braking constant $K$\\
\texttt{mb\_Msun} (op) & mass & 1 & Solar mass in code units\\
\texttt{mb\_Rsun} (op) & length & 1 & Solar radius in code units\\
\texttt{mb\_year} (op) & time & 1 & Julian year in code units\\
\texttt{mb\_Rossby\_sat} (op) & — & 0.1 & Critical Rossby number\\
\texttt{mb\_on} (part) & bool & 0 & Enable magnetic braking\\
\texttt{mb\_convective} (part) & bool & 0 & Convective‑envelope flag\\
\texttt{mb\_omega\_sat} (part) & 1/t & $\infty$ & Saturation angular velocity\\
\texttt{mb\_tau\_conv} (part) & time & — & Convective turnover time\\
\texttt{I} (part) & mass\,length$^2$ & — & Moment of inertia\\
\texttt{Omega} (part, vec) & 1/t & — & Spin angular-velocity vector (\texttt{reb\_vec3d})\\
\bottomrule
\end{tabular}
\end{table}

\subsection{Stellar Wind Mass Loss}
\label{sec:swml}

Isotropic winds remove mass from single stars according to the
Reimers prescription. For a star of mass $M$, luminosity $L$, and radius
$R$, the mass-loss rate is
\[
\dot M = -4\times10^{-13}\,\eta\,\frac{L}{L_\odot}\frac{R}{R_\odot}\frac{M_\odot}{M}
\;M_\odot\,\mathrm{yr}^{-1},
\]
where the dimensionless efficiency $\eta$ together with $L$ and $R$ are
specified per particle. Mass is removed isotropically with no linear-momentum
recoil; virtual particles are ignored and after mass loss the system is
recentred on the centre of mass.  A safety limiter caps the fractional
mass change to \texttt{swml\_max\_dlnM} (default $0.1$) per call.  The
prefactor, solar reference values, and the year length can be adjusted via
operator parameters (Table~\ref{tab:swml}).

\begin{table}[h]
\centering\footnotesize
\caption{Stellar wind mass-loss parameters}
\label{tab:swml}
\begin{tabular}{@{}llll@{}}
\toprule
Name (scope) & Unit & Default & Purpose \\
\midrule
\texttt{swml\_eta} (part) & — & — & Wind efficiency $\eta$\\
\texttt{swml\_L}   (part) & luminosity & — & Stellar luminosity $L$\\
\texttt{swml\_R}   (part) & length & — & Stellar radius $R$\\[0.2em]
\texttt{swml\_const} (op) & $M_\odot$/yr & $4\times10^{-13}$ & Reimers prefactor\\
\texttt{swml\_Msun}  (op) & mass & 1 & Solar mass in code units\\
\texttt{swml\_Rsun}  (op) & length & 1 & Solar radius in code units\\
\texttt{swml\_Lsun}  (op) & luminosity & 1 & Solar luminosity in code units\\
\texttt{swml\_year}  (op) & time & 1 & Length of Julian year in code units\\
\texttt{swml\_max\_dlnM} (op) & — & 0.1 & Max $|\Delta M|/M$ per call\\
\bottomrule
\end{tabular}
\end{table}

\subsection{Thermally Driven Winds}
\label{sec:tdw}

Thermal pressure can launch isotropic winds that carry away mass. For a star
of mass $M$, coronal temperature $T$, and radius $R$, we adopt a Parker-like
scaling
\[
\dot M = -C_{\rm th}\,\eta\,\left(\frac{R}{R_\odot}\right)^{\alpha_R}
                   \left(\frac{T}{T_\odot}\right)^{\alpha_T}
                   \left(\frac{M_\odot}{M}\right)^{\alpha_M}
\;M_\odot\,\mathrm{yr}^{-1},
\]
where $\eta$ is a dimensionless heating efficiency and the exponents have
defaults $(\alpha_R,\alpha_T,\alpha_M)=(2,\tfrac{3}{2},1)$.  Mass is removed
isotropically with no linear-momentum recoil; virtual particles are ignored,
and after mass loss the system is recentred on the centre of mass.  The
prefactor, solar reference values, exponents, maximum fractional mass change
per call, and the year length can be adjusted via operator parameters
(Table~\ref{tab:tdw}). The operator is unit-agnostic if these scaling
constants are specified consistently.

\begin{table}[h]
\centering\footnotesize
\caption{Thermally driven wind parameters}
\label{tab:tdw}
\begin{tabular}{@{}llll@{}}
\toprule
Name (scope) & Unit & Default & Purpose \\
\midrule
\texttt{tdw\_eta} (part) & — & — & Wind efficiency $\eta$\\
\texttt{tdw\_T}   (part) & temperature & — & Coronal temperature $T$\\
\texttt{tdw\_R}   (part) & length & — & Stellar radius $R$\\[0.2em]
\texttt{tdw\_const} (op) & $M_\odot$/yr & $2\times10^{-14}$ & Thermal-wind prefactor $C_{\rm th}$\\
\texttt{tdw\_Msun}  (op) & mass & 1 & Solar mass in code units\\
\texttt{tdw\_Rsun}  (op) & length & 1 & Solar radius in code units\\
\texttt{tdw\_Tsun}  (op) & temperature & $1.5\times10^6$ & Reference corona $T_\odot$ in code units\\
\texttt{tdw\_year}  (op) & time & 1 & Length of Julian year in code units\\
\texttt{tdw\_alpha\_R} (op) & — & 2 & Exponent $\alpha_R$ on $R/R_\odot$\\
\texttt{tdw\_alpha\_T} (op) & — & $3/2$ & Exponent $\alpha_T$ on $T/T_\odot$\\
\texttt{tdw\_alpha\_M} (op) & — & 1 & Exponent $\alpha_M$ on $M_\odot/M$\\
\texttt{tdw\_max\_dlnM} (op) & — & 0.1 & Max $|\Delta M|/M$ per call\\
\bottomrule
\end{tabular}
\end{table}

\subsection{Simplified Stellar Evolution}
\label{sec:sse}

To supply mass-dependent stellar properties the optional
\texttt{stellar\_evolution\_sse} operator updates each star's radius and
luminosity using power-law scalings inspired by \citet{Hurley2000}. For a
particle of mass $M$ (in $M_\odot$) we set
\[
R = R_{\rm coeff} R_\odot \left(\frac{M}{M_\odot}\right)^{R_{\rm exp}},\qquad
L = L_{\rm coeff} L_\odot \left(\frac{M}{M_\odot}\right)^{L_{\rm exp}}.
\]
The mass ratio $M/M_\odot$ uses the operator parameter
\texttt{sse\_Msun} (default 1) to convert code masses into solar masses;
\texttt{sse\_Rsun} and \texttt{sse\_Lsun} analogously define the solar radius
and luminosity in code units.  Each particle may override the scaling using the
particle-level parameters \texttt{sse\_R\_coeff}, \texttt{sse\_R\_exp},
\texttt{sse\_L\_coeff}, and \texttt{sse\_L\_exp}; if unspecified, the default
values in Table~\ref{tab:sse} are applied.  The particle's radius field is
replaced by $R$, and the luminosity $L$ is written to the attribute
\texttt{sse\_L}. Virtual particles are skipped, and stellar masses remain
unchanged.

\begin{table}[h]
\centering\footnotesize
\caption{Simplified stellar-evolution parameters}
\label{tab:sse}
\begin{tabular}{@{}llll@{}}
\toprule
Name (scope) & Unit & Default & Purpose \\
\midrule
\texttt{sse\_Msun}   (op) & mass      & 1   & Solar mass in code units\\
\texttt{sse\_Rsun}   (op) & length     & 1   & Solar radius in code units\\
\texttt{sse\_Lsun}   (op) & luminosity & 1   & Solar luminosity in code units\\
\texttt{sse\_R\_coeff} (part) & —       & 1   & Radius scaling prefactor\\
\texttt{sse\_R\_exp}   (part) & —       & 0.8 & Radius mass exponent\\
\texttt{sse\_L\_coeff} (part) & —       & 1   & Luminosity scaling prefactor\\
\texttt{sse\_L\_exp}   (part) & —       & 3.5 & Luminosity mass exponent\\
\bottomrule
\end{tabular}
\end{table}

%-------------------------------------------------------------------------------
\section{Algorithmic Flow}

Each operator call subdivides the requested time span into at least
\texttt{rlmt\_min\_substeps} internal steps.  The sub‑step size obeys the
limits $|\Delta M|/M\le\texttt{rlmt\_substep\_max\_dm}$ and
$|\Delta r|/r\le\texttt{rlmt\_substep\_max\_dr}$ to control mass transfer and
orbital motion.  An initial guard merges the pair if their separation falls
below $\varepsilon_{\rm merge}$, where
$\varepsilon_{\rm merge}=\texttt{merge\_eps}$ or
$0.5\min(R_{*},R_{\rm acc})$ when unspecified.

\begin{enumerate}[nosep]
\item \textbf{Pre‑check:} merge guard if $r\le\varepsilon_{\rm merge}$.
\item \textbf{Sub‑step loop} (adaptive):
  \begin{enumerate}[nosep]
    \item RLOF mass exchange and momentum bookkeeping.
    \item CE drag (if inside envelope).
    \item Secondary merge guard.
  \end{enumerate}
\item Purge zero‑mass particles.  If either the donor or accretor vanishes,
      the operator detaches automatically; finally the system is recentred on
      its centre of mass.
\end{enumerate}

%-------------------------------------------------------------------------------
\section{Run‑Time Parameters for Roche‑Lobe Transfer}
\label{sec:param_table}

\begin{table}[h]
\centering\footnotesize
\caption{Operator-level (\textit{op}) and particle-level (\textit{part}) parameters for the
Roche-lobe mass transfer effect.}
\label{tab:params}
\begin{tabular}{@{}lllll@{}}
\toprule
Name (scope) & Unit & Default & Purpose \\
\midrule
\texttt{rlmt\_donor}      (op)   & —        & — & Donor particle index\\
\texttt{rlmt\_accretor}   (op)   & —        & — & Accretor particle index\\
\texttt{rlmt\_Hp}         (part) & length   & — & Pressure‐scale height $H_P$\\
\texttt{rlmt\_mdot0}      (part) & M/t      & — & Reference rate $\dot M_0$\\[0.2em]
%
\texttt{rlmt\_loss\_fraction} (op) & —      & 0 & Wind mass fraction $f_{\mathrm loss}$\\
\texttt{jloss\_mode}      (op)   & int      & 0 & Choice in eqs.~\eqref{eq:joptions}\\
\texttt{jloss\_factor}    (op)   & —        & 1 & Scale factor $f_j$ (mode 3)\\
\texttt{rlmt\_skip\_in\_CE}(op)  & bool     & 1 & Disable RLOF if inside envelope\\[0.2em]
%
\texttt{rlmt\_substep\_max\_dm} (op) & —    & $10^{-3}$ & Max $|\Delta M|/M$ per sub‑step\\
\texttt{rlmt\_substep\_max\_dr} (op) & —    & $5\times10^{-3}$ & Max $|\Delta r|/r$ per sub‑step\\
\texttt{rlmt\_min\_substeps}    (op) & int  & 3 & Minimum sub‑steps per call\\[0.2em]
%
\texttt{rlmt\_R\_slope}      (part) & —     & 0 & Donor mass‑radius exponent $\alpha_R$\\
\texttt{rlmt\_R\_ref\_mass}  (part) & mass  & $M_{\rm init}$ & Reference mass $M_{\rm ref}$\\
\texttt{rlmt\_R\_ref\_radius}(part) & length& $R_{\rm init}$ & Reference radius $R_{\rm ref}$\\[0.2em]
%
\texttt{ce\_rho0}       (op) & density & — & Envelope density normalisation\\
\texttt{ce\_cs}         (op) & speed   & — & Sound-speed normalisation\\
\texttt{ce\_alpha\_rho}(op) & —       & 0 & Density power-law slope\\
\texttt{ce\_alpha\_cs} (op) & —       & 0 & Sound-speed power-law slope\\
\texttt{ce\_profile\_file}  (op) & path & — & ASCII $(s,\rho,c_s)$ profile, overrides power law\\
\texttt{ce\_kick\_cfl}      (op) & — & 1 & Velocity‑kick limiter\\
\texttt{ce\_xmin}           (op) & — & $10^{-4}$ & Coulomb cutoff $x_{\min}$\\
\texttt{ce\_Qd}             (op) & — & 0 & Geometric drag coefficient\\[0.2em]
\texttt{merge\_eps}         (op) & length & $0.5\min(R_*,R_{\rm acc})$ & Merge radius\\
\texttt{rlmt\_last\_dE}    (op, out) & energy & — & Energy change from last call\\
\bottomrule
\end{tabular}
\end{table}

%-------------------------------------------------------------------------------
\section{Post‐Newtonian Relativistic Corrections}

Compact binaries experience post‐Newtonian forces that couple the spins
and radiate orbital energy.  The
\texttt{post\_newtonian} effect implements the harmonic‐coordinate
point‐mass equations of motion of \citet{Kidder1995} for each pair of
massive bodies:
\begin{itemize}[nosep,leftmargin=1.8em]
  \item $1.5$\,PN spin–orbit couplings;
  \item $2$\,PN point‐mass and spin–spin conservative corrections;
  \item $2.5$\,PN gravitational‐wave radiation reaction.
\end{itemize}

\medskip
\noindent
For two bodies with masses $m_i$, $m_j$, separation vector $\mathbf{r}$,
relative velocity $\mathbf{v}$, define
\[
  m = m_i + m_j,\quad
  \eta = \frac{m_i\,m_j}{m^2},\quad
  \mathbf{n} = \frac{\mathbf{r}}{r},\quad
  \dot r = \mathbf{v}\cdot\mathbf{n},\quad
  \mu = \frac{m_i\,m_j}{m}.
\]
Then the relative acceleration additions are:
\medskip
\noindent\textbf{$1.5$\,PN spin–orbit (Eq.​2.2c of \citealp{Kidder1995}):}
\[
  \mathbf{a}_{1.5\mathrm{PN}}
  = \frac{G}{c^3\,r^3}
    \Bigl[
      6\,\mathbf{n}\bigl[(\mathbf{n}\times\mathbf{v})\!\cdot\!S_{\rm eff}\bigr]
     -(\mathbf{v}\times S_{7})
     +3\,\dot r\,(\mathbf{n}\times S_{3})
    \Bigr],
\]
where
\[
  S = S_1 + S_2,\quad
  \Delta = m\Bigl(\tfrac{S_2}{m_2}-\tfrac{S_1}{m_1}\Bigr),\quad
  S_{\rm eff} = 2\,S + \frac{m_1-m_2}{m}\,\Delta,
\]
\[
  S_{7} = 7\,S + 3\,\frac{m_1-m_2}{m}\,\Delta,\quad
  S_{3} = 3\,S + \frac{m_1-m_2}{m}\,\Delta.
\]

\medskip
\noindent\textbf{$2$\,PN conservative (Eqs.​2.2d–e of \citealp{Kidder1995}):}
\begin{align}
\mathbf{a}_{2\mathrm{PN}}^{\rm pm}
&= -\frac{G\,m}{c^4\,r^2}
   \Bigl[A_{2}\,\mathbf{n} \;+\; B_{v,2}\,\mathbf{v}\Bigr],\\
A_{2}
&= \tfrac{3}{4}(12+29\eta)\,\frac{G^2m^2}{r^2}
 +\eta(3-4\eta)\,v^4
 +\tfrac{15}{8}\,\eta(1-3\eta)\,\dot r^4
 -\tfrac{3}{2}\,\eta(3-4\eta)\,v^2\dot r^2
 -(2+25\eta+2\eta^2)\,\frac{G\,m}{r}\,\dot r^2,\\
B_{v,2}
&= -\tfrac{1}{2}\,\dot r
   \Bigl[\eta(15+4\eta)\,v^2
         -(4+41\eta+8\eta^2)\,\tfrac{G\,m}{r}
         -3\eta(3+2\eta)\,\dot r^2\Bigr],
\end{align}
\[
  \mathbf{a}_{2\mathrm{PN}}^{\rm ss}
  = -\frac{3\,G}{c^4\,r^4}
    \left[
      \frac{S_1\!\cdot\!S_2-5(\mathbf{n}\!\cdot\!S_1)(\mathbf{n}\!\cdot\!S_2)}{m_1 m_2}\,\mathbf{n}
     +\frac{\mathbf{n}\!\cdot\!S_2}{m_1^2}\,S_1
     +\frac{\mathbf{n}\!\cdot\!S_1}{m_2^2}\,S_2
    \right].
\]
Hence
\[
  \mathbf{a}_{2\mathrm{PN}}
  = \mathbf{a}_{2\mathrm{PN}}^{\rm pm}
  +\mathbf{a}_{2\mathrm{PN}}^{\rm ss}.
\]

\medskip
\noindent\textbf{$2.5$\,PN radiation reaction (Eq.​2.2f of \citealp{Kidder1995}):}
\begin{align}
\mathbf{a}_{2.5\mathrm{PN}}
&= \frac{8\,G^2\,m^2\,\eta}{5\,c^5\,r^3}
   \Bigl[
     \dot r\Bigl(18\,v^2 + \tfrac{2}{3}\,\tfrac{G\,m}{r} - 25\,\dot r^2\Bigr)\mathbf{n}
    -\Bigl(6\,v^2 - 2\,\tfrac{G\,m}{r} - 15\,\dot r^2\Bigr)\mathbf{v}
   \Bigr].
\end{align}

\medskip
\noindent
These accelerations are computed pairwise and then split between bodies
in proportion to their masses, ensuring total linear momentum conservation.

\bigskip
\noindent\textbf{Effect parameters:}
\begin{table}[h]
\centering\footnotesize
\begin{tabular}{@{}lll@{}}
\toprule
Field            & Unit             & Description                                \\
\midrule
\texttt{c}        & length/time      & Speed of light (required)                  \\
\texttt{pn\_15PN} & —                & Include 1.5 PN spin–orbit terms (default: 1)\\
\texttt{pn\_2PN}  & —                & Include 2 PN terms (default: 1)             \\
\texttt{pn\_25PN} & —                & Include 2.5 PN terms (default: 1)           \\
\bottomrule
\end{tabular}
\end{table}

\noindent\textbf{Particle parameter:}
\begin{table}[h]
\centering\footnotesize
\begin{tabular}{@{}lll@{}}
\toprule
Field               & Unit               & Description                               \\
\midrule
\texttt{pn\_spin}    & mass\,$L^2$/time   & Spin angular-momentum vector (\texttt{reb\_vec3d}, optional)   \\
\bottomrule
\end{tabular}
\end{table}

Setting the effect parameter \texttt{c} to the appropriate ratio of code
units to physical units reproduces the post\hyp Newtonian spin couplings and
gravitational\hyp wave driven inspiral
\citep{Peters1964,Kidder1995}.



%-------------------------------------------------------------------------------
\section{Discussion and Future Extensions}
\label{sec:future}
Future work may add direct coupling to tabulated stellar‑evolution tracks
so that $R_*(M)$ and $H_P(M)$ evolve self‑consistently.

%-------------------------------------------------------------------------------
\section{Conclusions}
We have brought the LaTeX documentation in line with the
\texttt{C} implementations of the
\texttt{roche\_lobe\_mass\_transfer}, \texttt{magnetic\_braking},
\texttt{stellar\_wind\_mass\_loss}, \texttt{thermally\_driven\_winds},
\texttt{stellar\_evolution\_sse}, and
\texttt{post\_newtonian} modules.
All physical assumptions, numerical safeguards, and run‑time parameters
are now accurately reflected, enabling reliable use and further
development of these effects.

%-------------------------------------------------------------------------------
\bibliographystyle{plainnat}
\begin{thebibliography}{}
\bibitem[Eggleton(1983)]{Eggleton1983}
  Eggleton,~P.\ 1983, \emph{ApJ}, 268, 368.
\bibitem[Kawaler(1988)]{Kawaler1988}
  Kawaler,~S.~D.\ 1988, \emph{ApJ}, 333, 236.
\bibitem[Reimers(1975)]{Reimers1975}
  Reimers,~D.\ 1975, \emph{Mem.\ Soc.\ R.\ Sci.\ Li\`ege}, 8, 369.
\bibitem[Ostriker(1999)]{Ostriker1999}
  Ostriker,~E.\ 1999, \emph{ApJ}, 513, 252.
\bibitem[Peters(1964)]{Peters1964}
  Peters,~P.\ 1964, \emph{Phys.\ Rev.}, 136, B1224.
\bibitem[Kidder(1995)]{Kidder1995}
  Kidder,~L.~E.\ 1995, \emph{Phys.\ Rev.\ D}, 52, 821.
\bibitem[Einstein(1915)]{Einstein1915}
  Einstein,~A.\ 1915, \emph{Preuss.\ Akad.\ Wiss.\ Berlin}, 831.
\bibitem[Ritter(1988)]{Ritter1988}
  Ritter,~H.\ 1988, \emph{A\&A}, 202, 93.
\bibitem[Verbunt \& Zwaan(1981)]{Verbunt1981}
  Verbunt,~F. \& Zwaan,~C.\ 1981, \emph{A\&A}, 100, L7.
\bibitem[Hurley et~al.(2000)]{Hurley2000}
  Hurley,~J.~R., Pols,~O.~R., \& Tout,~C.~A.\ 2000, \emph{MNRAS}, 315, 543.
\end{thebibliography}

\end{document}
